<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 使用xml的形式配置mapper，此处编写sql映射文件 -->
<mapper namespace="com.dadagum.group.mapper.ProjectMapper">
    <insert id="insertProejct" useGeneratedKeys="true" keyProperty="id">>
        insert into project ( name, description, gid, uid, start_time, end_time, finish) values
            (#{project.getName()},#{project.getDescription()},#{project.getGid()},#{project.getUid()},#{project.getStartTime()},#{project.getEndTime()},#{project.getFinish()});
    </insert>

    <delete id="deleteProjectById">
        delete from project where id=#{pid};
    </delete>

    <select id="getProjectById">
        select * from project where id=#{pid};
    </select>

    <select id="getLeaderById">
        select uid from project where id=#{pid};
    </select>

    <select id="listUserProject" resultType="com.dadagum.team.common.model.Project">
        select * from project where id in(select pid from user_project where user_project.uid=#{uid})
        <if test="query.getGid() !=null and query.getGid()!= ''">
            and gid=#{query.getGid()}
        </if>
    </select>

    <update id="updateProject">
        update project
        <set>
            <if test="project.getName()!=null and project.getName()!=''">
                name=#{project.getName()}
            </if>
            <if test="project.getDescription()!=null and project.getDescription()!=''">
                description=#{project.getDescription()}
            </if>
            <if test="project.getGid(0!=null and project.getGid()!=''">
                gid=#{project.getGid()}
            </if>
            <if test="project.getUid()!=null and project.getUid()!=''">
                uid=#{project.getUid()}
            </if>
            <if test="project.getStartTime()!=null and project.getStartTime()!=''">
                start_time=#{project.getStartTime()}
            </if>
            <if test="project.getEndTime()!=null and project.getEndTime()!=''">
                end_time=#{project.getEndTime()}
            </if>
            <if test="project.getFinish()!=null and project.getFinish()!=''">
                finish=#{project.getFinish()}
            </if>
        </set>
        where id=#{project.getId()};
    </update>

    <insert id="insertUserProject">
        insert into user_project(uid, pid) VALUES
        <foreach collection="list" item="uid" index="index" separator=",">
            (#{uid},#{pid})
        </foreach>
    </insert>

    <delete id="deleteUserFromProject">
        delete from user_project where pid=#{pid} and uid in
        <foreach collection="list" item="uid" index="index" separator=",">
            #{uid}
        </foreach>
    </delete>
</mapper>